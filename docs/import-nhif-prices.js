/**
 * Google Apps Script –∑–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –ù–ó–û–ö —Ü–µ–Ω–∏
 * 
 * –ò–ù–°–¢–†–£–ö–¶–ò–ò:
 * 1. –û—Ç–≤–æ—Ä–∏ Google Sheet –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏
 * 2. Extensions -> Apps Script
 * 3. –î–æ–±–∞–≤–∏ —Ç–æ–∑–∏ –∫–æ–¥ –∫–∞—Ç–æ –Ω–æ–≤ —Ñ–∞–π–ª –∏–ª–∏ –¥–æ–±–∞–≤–∏ —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞ –∫—ä–º —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∏—è
 * 4. –ò–∑–ø—ä–ª–Ω–∏ —Ñ—É–Ω–∫—Ü–∏—è—Ç–∞: importNHIFPrices()
 */

/**
 * –ò–º–ø–æ—Ä—Ç–∏—Ä–∞ —Ä–µ–∞–ª–Ω–∏—Ç–µ –ù–ó–û–ö —Ü–µ–Ω–∏ –≤ –ª–∏—Å—Ç–∞ NHIF_Prices
 */
function importNHIFPrices() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  let sheet = ss.getSheetByName('NHIF_Prices');
  
  if (!sheet) {
    SpreadsheetApp.getUi().alert('–õ–∏—Å—Ç—ä—Ç NHIF_Prices –Ω–µ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞. –ü—ä—Ä–≤–æ –∏–∑–ø—ä–ª–Ω–µ—Ç–µ setupDatabase()');
    return;
  }
  
  // –ò–∑—á–∏—Å—Ç–∏ —Å—Ç–∞—Ä–∏—Ç–µ –¥–∞–Ω–Ω–∏ (–∑–∞–ø–∞–∑–∏ –∑–∞–≥–ª–∞–≤–Ω–∏—è —Ä–µ–¥)
  const lastRow = sheet.getLastRow();
  if (lastRow > 1) {
    sheet.getRange(2, 1, lastRow - 1, sheet.getLastColumn()).clear();
  }
  
  // –ù–ó–û–ö –¶–µ–Ω–æ—Ä–∞–∑–ø–∏—Å - —Ä–µ–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏
  // –¶–µ–Ω–∏—Ç–µ —Å–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞–Ω–∏ –æ—Ç EUR –≤ BGN (–∫—É—Ä—Å ~1.96)
  const nhifPrices = [
    // –ü—Ä–µ–≥–ª–µ–¥–∏
    ['nhif_101', '101', '–û–±—Å—Ç–æ–µ–Ω –ø—Ä–µ–≥–ª–µ–¥ —Å—ä—Å —Å–Ω–µ–º–∞–Ω–µ –Ω–∞ –æ—Ä–∞–ª–µ–Ω —Å—Ç–∞—Ç—É—Å', 32.81, 32.81, 0, 0, '–ü—Ä–µ–≥–ª–µ–¥'],
    ['nhif_101b', '101', '–û–±—Å—Ç–æ–µ–Ω –ø—Ä–µ–≥–ª–µ–¥ - –±—Ä–µ–º–µ–Ω–Ω–∏', 32.81, 0, 0, 0, '–ü—Ä–µ–≥–ª–µ–¥'],
    
    // –û–±—Ç—É—Ä–∞—Ü–∏–∏ (–ø–ª–æ–º–±–∏)
    ['nhif_301', '301', '–û–±—Ç—É—Ä–∞—Ü–∏—è —Å —Ö–∏–º–∏—á–µ–Ω –∫–æ–º–ø–æ–∑–∏—Ç', 89.51, 85.51, 0, 4.02, '–õ–µ—á–µ–Ω–∏–µ'],
    
    // –ï–∫—Å—Ç—Ä–∞–∫—Ü–∏–∏
    ['nhif_508', '508', '–ï–∫—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞ –≤—Ä–µ–º–µ–Ω–µ–Ω –∑—ä–± —Å –∞–Ω–µ—Å—Ç–µ–∑–∏—è', 35.97, 0, 0, 0, '–•–∏—Ä—É—Ä–≥–∏—è'],
    ['nhif_509', '509', '–ï–∫—Å—Ç—Ä–∞–∫—Ü–∏—è –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–µ–Ω –∑—ä–± —Å –∞–Ω–µ—Å—Ç–µ–∑–∏—è', 89.51, 85.51, 0, 4.02, '–•–∏—Ä—É—Ä–≥–∏—è'],
    
    // –ï–Ω–¥–æ–¥–æ–Ω—Ç–∏—è
    ['nhif_332', '332', '–õ–µ—á–µ–Ω–∏–µ –Ω–∞ –ø—É–ª–ø–∏—Ç/–ø–µ—Ä–∏–æ–¥–æ–Ω—Ç–∏—Ç –Ω–∞ –≤—Ä–µ–º–µ–Ω–µ–Ω –∑—ä–±', 48.18, 0, 4.70, 0, '–ï–Ω–¥–æ–¥–æ–Ω—Ç–∏—è'],
    ['nhif_333', '333', '–õ–µ—á–µ–Ω–∏–µ –Ω–∞ –ø—É–ª–ø–∏—Ç/–ø–µ—Ä–∏–æ–¥–æ–Ω—Ç–∏—Ç –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–µ–Ω –∑—ä–±', 155.37, 0, 6.02, 0, '–ï–Ω–¥–æ–¥–æ–Ω—Ç–∏—è'],
    
    // –ü—Ä–æ—Ç–µ–∑–∏
    ['nhif_832', '832', '–ì–æ—Ä–Ω–∞ —Ü—è–ª–∞ –ø–ª–∞–∫–æ–≤–∞ –∑—ä–±–Ω–∞ –ø—Ä–æ—Ç–µ–∑–∞ (–∫–ª–∏–Ω–∏—á–Ω–∞ –¥–µ–π–Ω–æ—Å—Ç)', 287.89, 0, 0, 0, '–ü—Ä–æ—Ç–µ—Ç–∏–∫–∞'],
    ['nhif_833', '833', '–î–æ–ª–Ω–∞ —Ü—è–ª–∞ –ø–ª–∞–∫–æ–≤–∞ –∑—ä–±–Ω–∞ –ø—Ä–æ—Ç–µ–∑–∞ (–∫–ª–∏–Ω–∏—á–Ω–∞ –¥–µ–π–Ω–æ—Å—Ç)', 287.89, 0, 0, 0, '–ü—Ä–æ—Ç–µ—Ç–∏–∫–∞'],
    ['nhif_834', '834', '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞ –∏–∑—Ä–∞–±–æ—Ç–∫–∞ –≥–æ—Ä–Ω–∞ –ø—Ä–æ—Ç–µ–∑–∞ (–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è)', 60.88, 0, 0, 0, '–ü—Ä–æ—Ç–µ—Ç–∏–∫–∞'],
    ['nhif_835', '835', '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞ –∏–∑—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ª–Ω–∞ –ø—Ä–æ—Ç–µ–∑–∞ (–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è)', 60.88, 0, 0, 0, '–ü—Ä–æ—Ç–µ—Ç–∏–∫–∞']
  ];
  
  // –ù–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ headers
  const headers = [
    'id',
    'code', 
    'name',
    'priceUnder18',
    'priceOver18', 
    'patientPayUnder18',
    'patientPayOver18',
    'category'
  ];
  
  // –û–±–Ω–æ–≤–∏ –∑–∞–≥–ª–∞–≤–Ω–∏—è —Ä–µ–¥
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  
  // –§–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∏—è —Ä–µ–¥
  sheet.getRange(1, 1, 1, headers.length)
    .setBackground('#ec4899')
    .setFontColor('#ffffff')
    .setFontWeight('bold');
  
  // –î–æ–±–∞–≤–∏ –¥–∞–Ω–Ω–∏—Ç–µ
  sheet.getRange(2, 1, nhifPrices.length, headers.length).setValues(nhifPrices);
  
  // –§–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ü–µ–Ω–∏—Ç–µ
  sheet.getRange('D2:G1000').setNumberFormat('#,##0.00 "–ª–≤."');
  
  // –†–∞–∑—à–∏—Ä–∏ –∫–æ–ª–æ–Ω–∏—Ç–µ
  sheet.setColumnWidth(3, 400); // name
  sheet.setColumnWidth(4, 100); // priceUnder18
  sheet.setColumnWidth(5, 100); // priceOver18
  sheet.setColumnWidth(6, 120); // patientPayUnder18
  sheet.setColumnWidth(7, 120); // patientPayOver18
  
  SpreadsheetApp.getUi().alert('‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω–∏ —Å–∞ ' + nhifPrices.length + ' –ù–ó–û–ö –ø—Ä–æ—Ü–µ–¥—É—Ä–∏!');
}

/**
 * –î–æ–±–∞–≤—è –±—É—Ç–æ–Ω –≤ –º–µ–Ω—é—Ç–æ –∑–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ
 */
function onOpen() {
  const ui = SpreadsheetApp.getUi();
  ui.createMenu('ü¶∑ –†–æ–¥–æ–ø–∏ –î–µ–Ω—Ç')
    .addItem('–ù–∞—Å—Ç—Ä–æ–π –±–∞–∑–∞—Ç–∞ –¥–∞–Ω–Ω–∏', 'setupDatabase')
    .addItem('–ò–º–ø–æ—Ä—Ç–∏—Ä–∞–π –ù–ó–û–ö —Ü–µ–Ω–∏', 'importNHIFPrices')
    .addSeparator()
    .addItem('–î–æ–±–∞–≤–∏ —Ç–µ—Å—Ç–æ–≤–∏ –∑–∞–ø–∏—Å–∏', 'addTestAppointments')
    .addToUi();
}
